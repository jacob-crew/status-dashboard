<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Status Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; }
    h1 { text-align: center; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(750px, 1fr)); gap: 1rem; margin-top: 20px; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .status { font-weight: bold; }
    .green { color: green; }
    .yellow { color: goldenrod; }
    .red { color: crimson; }
  </style>
</head>
<body>
  <h1>Status Dashboard</h1>
  <div class="grid" id="statusGrid"></div>

  <script>
    const companies = [
      { name: "Salesforce", type: "salesforce", url: "https://api.status.salesforce.com/v1/instances/USA322/status"  },
      { name: "FormAssembly", type: "statuspage", url: "https://status.formassembly.com/api/v2/status.json" },
      { name: "Blackthorn Events", type: "blackthorn", url: "https://blackthorn.statuspage.io/api/v2/summary.json" },
      { name: "Conga", type: "statuspage", url: "https://status.conga.com/api/v2/status.json" },
      { name: "Mogli (Twilio)", type: "statuspage", url: "https://status.twilio.com/api/v2/status.json" },
      { name: "ProvenWorks", type: "statuspage", url: "https://status.provenworks.com/api/v2/status.json" },
      { name: "Slack", type: "slack", url: "https://slack-status.com/api/v2.0.0/current" },
      { name: "Asana", type: "statuspage", url: "https://status.asana.com//api/v2/status.json" }
      // Add more here...
    ];

// Free CORS proxy (light use only; replace with your own server for production)
const PROXY = "https://corsproxy.io/?";

async function fetchStatus(company) {
  let fetchUrl = company.url;

  // Use proxy for non-Statuspage APIs
  if (!fetchUrl.includes("statuspage.io") && !fetchUrl.includes("githubstatus.com")) {
    fetchUrl = PROXY + encodeURIComponent(fetchUrl);
  }

  try {
    const res = await fetch(fetchUrl);

    // Some APIs return HTML error pages → prevent JSON parse crash
    const text = await res.text();
    try {
      return JSON.parse(text);
    } catch {
      return { error: `Invalid response (likely blocked by CORS): ${text.substring(0, 60)}...` };
    }

  } catch (err) {
    return { error: err.message };
  }
}

async function renderDashboard() {
  const container = document.getElementById("dashboard");
  container.innerHTML = "";

  for (const company of companies) {
    const data = await fetchStatus(company);

    const div = document.createElement("div");
    div.className = "card";

    if (data.error) {
      div.innerHTML = `
        <h2>${company.name}</h2>
        <p style="color:red;">❌ Error: ${data.error}</p>
      `;
    } else if (data.status && data.status.description) {
      // Statuspage.io style
      div.innerHTML = `
        <h2>${company.name}</h2>
        <p>Status: ${data.status.description}</p>
      `;
    } else {
      // Fallback (non-Statuspage APIs)
      div.innerHTML = `
        <h2>${company.name}</h2>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }

    container.appendChild(div);
  }
}

renderDashboard();
  </script>
</body>
</html>
